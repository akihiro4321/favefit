# FaveFit 画面操作テストシナリオ

## 概要

このドキュメントは、FaveFitアプリケーションの画面操作を検証するためのテストシナリオを記載したものです。ユーザーフロードキュメント（`user-flow.md`）を基に、実際のユーザー操作を想定したテストケースを整理しています。

## テストシナリオの構成

各テストシナリオは以下の形式で記載します：
- **シナリオ名**: テストの目的を表す名前
- **前提条件**: テスト実行前の状態
- **テストステップ**: 実行する操作の詳細
- **期待される結果**: 各ステップで期待される動作
- **確認ポイント**: 特に注意すべき点

---

## フェーズ1: 開始フェーズ（ログイン → オンボーディング）

### シナリオ1-1: Googleログイン → 新規ユーザーのオンボーディング

**前提条件:**
- アプリが起動している
- ユーザーは未ログイン状態

**テストステップ:**

1. **ログインページの表示確認**
   - [ ] アプリを起動
   - [ ] ログインページが表示されることを確認

2. **Googleログイン実行**
   - [ ] 「Googleでログイン」ボタンをクリック
   - [ ] Google認証画面が表示されることを確認
   - [ ] Googleアカウントでログイン

3. **オンボーディングページへの遷移確認**
   - [ ] ログイン成功後、オンボーディングページ（`/onboarding`）に遷移することを確認
   - [ ] Step 1（基本情報）が表示されることを確認

4. **Step 1: 基本情報入力**
   - [ ] ニックネームを入力（例: "テストユーザー"）
   - [ ] 現在の体重を入力（例: 65kg）
   - [ ] 目標体重を入力（例: 60kg）
   - [ ] 目標達成期限を選択（例: 3ヶ月後）
   - [ ] チートデイ頻度を選択（例: 週1回）
   - [ ] 「次へ」ボタンをクリック

5. **Step 2: 身体情報入力**
   - [ ] Step 2が表示されることを確認
   - [ ] 年齢を入力（例: 30）
   - [ ] 性別を選択（例: 男性）
   - [ ] 身長を入力（例: 170cm）
   - [ ] 活動レベルを選択（例: 週2-3回の運動）
   - [ ] 目標を選択（例: 痩せたい）
   - [ ] 「AIで計算」ボタンをクリック

6. **Step 3: 栄養目標確認**
   - [ ] Step 3が表示されることを確認
   - [ ] AIが計算した1日の目標カロリーが表示されることを確認
   - [ ] PFC（タンパク質・脂質・炭水化物）が表示されることを確認
   - [ ] 戦略サマリーが表示されることを確認
   - [ ] 「次へ」ボタンをクリック

7. **Step 4: 好み設定**
   - [ ] Step 4が表示されることを確認
   - [ ] アレルギー・苦手な食材を入力（例: "えび"）
   - [ ] 好きな食材を入力（例: "鶏肉"）
   - [ ] 好きなジャンルを選択（例: "和食"、"洋食"）
   - [ ] 味付けの好みを選択（例: "普通"）
   - [ ] 料理スキルを選択（例: "普通"）
   - [ ] 調理時間の目安を選択（例: "普通"）
   - [ ] 「次へ」ボタンをクリック

8. **Step 5: プラン作成**
   - [ ] Step 5が表示されることを確認
   - [ ] 「準備完了！」メッセージが表示されることを確認
   - [ ] 「プランを作成する」ボタンをクリック

9. **プラン作成中の確認**
   - [ ] プラン作成中画面が表示されることを確認
   - [ ] ローディングスピナーが表示されることを確認
   - [ ] 「プラン作成中...」メッセージが表示されることを確認
   - [ ] 「1〜2分程度かかります」説明が表示されることを確認

10. **プラン生成完了の確認**
    - [ ] 1〜2分待機
    - [ ] 自動的にPending状態のプラン表示に切り替わることを確認
    - [ ] プラン概要カードが表示されることを確認
    - [ ] 日別カードが表示されることを確認

**期待される結果:**
- すべてのステップが正常に完了する
- 各画面遷移がスムーズに行われる
- 入力した情報が正しく保存される
- プランが正常に生成される

**確認ポイント:**
- プロフィール設定済みの場合はスキップオプションが表示される
- プラン作成中にページを閉じても問題なく動作する
- 5秒ごとに状態がチェックされる

---

### シナリオ1-2: ゲストログイン → オンボーディング

**前提条件:**
- アプリが起動している
- ユーザーは未ログイン状態

**テストステップ:**

1. **ログインページの表示確認**
   - [ ] アプリを起動
   - [ ] ログインページが表示されることを確認

2. **ゲストログイン実行**
   - [ ] 「ゲストとして続ける」ボタンをクリック
   - [ ] 認証が完了することを確認

3. **オンボーディングページへの遷移確認**
   - [ ] オンボーディングページ（`/onboarding`）に遷移することを確認
   - [ ] 以降はシナリオ1-1のStep 4以降と同じ

**期待される結果:**
- ゲストログインが正常に完了する
- オンボーディングフローが正常に動作する

**確認ポイント:**
- ゲストユーザーでもオンボーディングが正常に動作する

---

### シナリオ1-3: 既存ユーザーのログイン（オンボーディング完了済み）

**前提条件:**
- アプリが起動している
- ユーザーは未ログイン状態
- 既存のユーザーアカウントが存在する（オンボーディング完了済み）

**テストステップ:**

1. **ログイン実行**
   - [ ] 「Googleでログイン」または「ゲストとして続ける」をクリック
   - [ ] ログインが完了することを確認

2. **ホーム画面への遷移確認**
   - [ ] オンボーディングをスキップしてホーム画面（`/home`）に遷移することを確認
   - [ ] プランがない場合は「プランを作成する」ボタンが表示されることを確認

**期待される結果:**
- オンボーディングがスキップされる
- ホーム画面が表示される

**確認ポイント:**
- 既存ユーザーはオンボーディングを再度実行しない

---

## フェーズ2: プラン作成フェーズ（プラン生成 → 承認待ち）

### シナリオ2-1: プランなし状態からプラン作成

**前提条件:**
- ユーザーはログイン済み
- オンボーディング完了済み
- プランが存在しない

**テストステップ:**

1. **プラン画面へのアクセス**
   - [ ] ナビゲーションから「プラン」をタップ
   - [ ] プラン画面（`/plan`）が表示されることを確認

2. **プランなし画面の確認**
   - [ ] 「プランがありません」メッセージが表示されることを確認
   - [ ] 「まずは2週間のプランを作成しましょう」説明が表示されることを確認
   - [ ] 「プランを作成する」ボタンが表示されることを確認

3. **プラン作成開始**
   - [ ] 「プランを作成する」ボタンをクリック
   - [ ] プラン作成中画面が表示されることを確認

4. **プラン生成完了の確認**
   - [ ] 1〜2分待機
   - [ ] Pending状態のプラン表示に切り替わることを確認

**期待される結果:**
- プランが正常に生成される
- Pending状態のプランが表示される

**確認ポイント:**
- プラン生成中にページを閉じても問題なく動作する

---

### シナリオ2-2: プラン作成中の状態確認

**前提条件:**
- プラン作成が開始されている
- `planCreationStatus === "creating"`

**テストステップ:**

1. **プラン作成中画面の表示確認**
   - [ ] プラン画面、ホーム画面、オンボーディング画面のいずれかにアクセス
   - [ ] プラン作成中画面が表示されることを確認

2. **定期的な状態チェックの確認**
   - [ ] 5秒ごとにプロフィールとプランが再取得されることを確認（開発者ツールで確認）

3. **プラン生成完了後の自動遷移確認**
   - [ ] プラン生成完了後、自動的にPending状態のプラン表示に切り替わることを確認

**期待される結果:**
- プラン作成中画面が正しく表示される
- 定期的に状態がチェックされる
- 生成完了後に自動的に遷移する

**確認ポイント:**
- 複数の画面でプラン作成中状態が正しく表示される

---

## フェーズ3: 承認フェーズ（承認/拒否 → Active化）

### シナリオ3-1: プラン承認フロー

**前提条件:**
- Pending状態のプランが存在する
- プラン画面（`/plan`）が表示されている

**テストステップ:**

1. **Pending状態のプラン表示確認**
   - [ ] 「承認待ち」バッジが表示されることを確認
   - [ ] プラン概要カードが表示されることを確認:
     - [ ] 14日間の平均栄養価
     - [ ] 使用ジャンル・タグ
     - [ ] チートデイ情報
   - [ ] 日別カードが詳細表示されることを確認:
     - [ ] レシピタイトル（全文）
     - [ ] タグ（最大3つ）
     - [ ] 栄養価（カロリー、PFC）

2. **承認ボタンの確認**
   - [ ] 「このプランで進める」ボタンが表示されることを確認
   - [ ] 「別のプランを生成する」ボタンが表示されることを確認

3. **プラン承認実行**
   - [ ] 「このプランで進める」ボタンをクリック
   - [ ] 承認処理が開始されることを確認（ローディング表示）

4. **承認完了の確認**
   - [ ] 成功メッセージが表示されることを確認:
     - [ ] 「プランを承認しました。レシピ詳細を生成中です。完了まで1〜2分かかる場合があります。」
   - [ ] Active状態のプラン表示に切り替わることを確認

5. **Active状態のプラン表示確認**
   - [ ] 「承認待ち」バッジが消えることを確認
   - [ ] 日別カードが簡易表示に切り替わることを確認:
     - [ ] レシピタイトル（切り詰め表示）
     - [ ] カロリーのみ表示
   - [ ] 「飽きた」ボタンと「一括再生成」ボタンが表示されることを確認

6. **レシピ詳細生成の確認**
   - [ ] 1〜2分待機
   - [ ] レシピ詳細ページにアクセス
   - [ ] 材料と手順が表示されることを確認

**期待される結果:**
- プランが正常に承認される
- Active状態のプランが表示される
- レシピ詳細がバックグラウンドで生成される

**確認ポイント:**
- 承認後、レシピ詳細生成がバックグラウンドで実行される
- 買い物リストが生成される

---

### シナリオ3-2: プラン拒否フロー

**前提条件:**
- Pending状態のプランが存在する
- プラン画面（`/plan`）が表示されている

**テストステップ:**

1. **拒否ボタンの確認**
   - [ ] 「別のプランを生成する」ボタンが表示されることを確認

2. **プラン拒否実行**
   - [ ] 「別のプランを生成する」ボタンをクリック
   - [ ] 確認ダイアログが表示されることを確認:
     ```
     このプランを拒否しますか？
     別のプランを生成できます。
     ```

3. **確認ダイアログでの操作**
   - [ ] 「キャンセル」をクリック → ダイアログが閉じ、プランがそのまま表示されることを確認
   - [ ] 再度「別のプランを生成する」ボタンをクリック
   - [ ] 「OK」をクリック

4. **拒否完了の確認**
   - [ ] プランがアーカイブされることを確認
   - [ ] プランなし画面に戻ることを確認
   - [ ] 「プランを作成する」ボタンが再表示されることを確認

**期待される結果:**
- プランが正常に拒否される
- プランなし状態に戻る
   - 新しいプランを作成できる状態になる

**確認ポイント:**
- 拒否したプランは`archived`状態になる
- 再度プランを作成できる

---

## フェーズ4: 日常利用フェーズ

### シナリオ4-1: ホーム画面での操作

**前提条件:**
- Active状態のプランが存在する
- ユーザーはログイン済み

**テストステップ:**

1. **ホーム画面の表示確認**
   - [ ] ナビゲーションから「ホーム」をタップ
   - [ ] ホーム画面（`/home`）が表示されることを確認

2. **今日のメニュー表示確認**
   - [ ] 「今日のメニュー」タイトルが表示されることを確認
   - [ ] 目標カロリーと残りカロリーが表示されることを確認
   - [ ] 進捗バーが表示されることを確認
   - [ ] 食事カード（朝食・昼食・夕食）が表示されることを確認:
     - [ ] 食事タイプ（🍳 朝食、🍱 昼食、🍽️ 夕食）
     - [ ] レシピタイトル
     - [ ] カロリー

3. **レシピ詳細への遷移**
   - [ ] 朝食カードをクリック
   - [ ] レシピ詳細ページ（`/recipe/{recipeId}`）に遷移することを確認

4. **別のメニュー提案への遷移**
   - [ ] ホーム画面に戻る
   - [ ] 「🥗 別のメニューを提案」ボタンをクリック
   - [ ] 冷蔵庫提案ページ（`/fridge`）に遷移することを確認

**期待される結果:**
- ホーム画面が正しく表示される
- 今日のメニューが正しく表示される
- 各ボタンが正常に動作する

**確認ポイント:**
- チートデイの場合は特別な表示になる
- 完了済みの食事には「完了」バッジが表示される

---

### シナリオ4-2: レシピ詳細ページでの操作（未完了時）

**前提条件:**
- Active状態のプランが存在する
- レシピ詳細ページ（`/recipe/{recipeId}`）が表示されている
- レシピは未完了状態

**テストステップ:**

1. **レシピ詳細の表示確認**
   - [ ] レシピタイトルが表示されることを確認
   - [ ] 栄養情報（カロリー、PFC）が表示されることを確認
   - [ ] タグが表示されることを確認
   - [ ] 材料リストが表示されることを確認
   - [ ] 手順リストが表示されることを確認

2. **お気に入りボタンの操作**
   - [ ] お気に入りボタン（ハートアイコン）をクリック
   - [ ] 「また作りたいリストに追加しました！」アラートが表示されることを確認

3. **「作った！」ボタンの操作**
   - [ ] 「作った！」ボタンをクリック
   - [ ] レシピが完了済みにマークされることを確認
   - [ ] 評価フォームが表示されることを確認

4. **評価フォームの入力**
   - [ ] 「実際に作りましたか？」で「はい」を選択
   - [ ] 総合評価を入力（例: 5つ星）
   - [ ] 味の好み、作りやすさ、満足感を入力
   - [ ] 「また作りたいですか？」を選択（例: "ぜひ作りたい"）
   - [ ] コメントを入力（任意）
   - [ ] 「評価を送信する」ボタンをクリック

5. **評価送信完了の確認**
   - [ ] 「Thank you! あなたの好みを学習しました。」メッセージが表示されることを確認
   - [ ] 2秒後にホーム画面に遷移することを確認

6. **「別のレシピに変更」ボタンの操作**
   - [ ] レシピ詳細ページに再度アクセス
   - [ ] 「別のレシピに変更」ボタンをクリック
   - [ ] 冷蔵庫提案ページに遷移することを確認（差し替えモード）
   - [ ] URLパラメータが正しく設定されていることを確認:
     - [ ] `?swap={recipeId}&planId={planId}&date={date}&mealType={mealType}`

**期待される結果:**
- レシピ詳細が正しく表示される
- お気に入り機能が正常に動作する
- レシピ完了機能が正常に動作する
- 評価フォームが正常に動作する
- レシピ差し替え機能が正常に動作する

**確認ポイント:**
- レシピ詳細が不足している場合は自動的に生成される
- 完了済みレシピには「完了済み」バッジが表示される

---

### シナリオ4-3: レシピ詳細ページでの操作（完了済み時）

**前提条件:**
- Active状態のプランが存在する
- レシピ詳細ページ（`/recipe/{recipeId}`）が表示されている
- レシピは完了済み状態

**テストステップ:**

1. **完了済み状態の表示確認**
   - [ ] 「完了済み」バッジが表示されることを確認
   - [ ] 「評価する」ボタンが表示されることを確認
   - [ ] 「作った！」ボタンと「別のレシピに変更」ボタンが表示されないことを確認

2. **評価フォームの表示**
   - [ ] 「評価する」ボタンをクリック
   - [ ] 評価フォームが表示されることを確認

3. **評価フォームの入力と送信**
   - [ ] 評価を入力
   - [ ] 「評価を送信する」ボタンをクリック
   - [ ] 評価が送信されることを確認

**期待される結果:**
- 完了済みレシピが正しく表示される
- 評価フォームが正常に動作する

**確認ポイント:**
- 完了済みレシピは再度「作った！」を押せない

---

### シナリオ4-4: 冷蔵庫提案ページでの操作（通常モード）

**前提条件:**
- Active状態のプランが存在する
- 冷蔵庫提案ページ（`/fridge`）が表示されている
- 差し替えモードではない

**テストステップ:**

1. **入力フォームの表示確認**
   - [ ] 「冷蔵庫からメニュー提案」タイトルが表示されることを確認
   - [ ] 「手元にある食材から、AIがレシピを提案します」説明が表示されることを確認
   - [ ] 食材入力テキストエリアが表示されることを確認
   - [ ] 希望コメント入力テキストエリアが表示されることを確認
   - [ ] 「レシピを提案してもらう」ボタンが表示されることを確認

2. **レシピ提案の実行**
   - [ ] 食材を入力（例: "鶏もも肉、キャベツ、にんじん、卵"）
   - [ ] 希望コメントを入力（例: "さっぱりしたもの"）
   - [ ] 「レシピを提案してもらう」ボタンをクリック
   - [ ] ローディング表示が表示されることを確認

3. **提案結果の表示確認**
   - [ ] 「3つのレシピを提案します」メッセージが表示されることを確認
   - [ ] 3つのレシピカードが表示されることを確認:
     - [ ] レシピタイトル
     - [ ] 説明文
     - [ ] タグ（バッジ）
     - [ ] 追加で必要な食材（ある場合）

4. **レシピ選択**
   - [ ] 1つ目のレシピカードをクリック
   - [ ] レシピ詳細ページ（`/recipe/{recipeId}`）に遷移することを確認

5. **再提案の実行**
   - [ ] 冷蔵庫提案ページに戻る
   - [ ] 「さっぱり系で」ボタンをクリック
   - [ ] 新しいレシピ提案が表示されることを確認
   - [ ] 「こってり系で」ボタンをクリック
   - [ ] 新しいレシピ提案が表示されることを確認

6. **フォームリセット**
   - [ ] 「食材を入力し直す」ボタンをクリック
   - [ ] フォームがリセットされることを確認
   - [ ] 入力フォームが再表示されることを確認

**期待される結果:**
- レシピ提案が正常に動作する
- 再提案機能が正常に動作する
- フォームリセットが正常に動作する

**確認ポイント:**
- コメント付き再提案が正常に動作する
- 前回の提案履歴が考慮される

---

### シナリオ4-5: 冷蔵庫提案ページでの操作（差し替えモード）

**前提条件:**
- Active状態のプランが存在する
- レシピ詳細ページから「別のレシピに変更」をクリック
- 冷蔵庫提案ページ（`/fridge?swap=...`）が表示されている

**テストステップ:**

1. **差し替えモードの表示確認**
   - [ ] 「プラン内のレシピを差し替えるレシピを選んでください」説明が表示されることを確認

2. **レシピ提案の実行**
   - [ ] 食材を入力
   - [ ] 「レシピを提案してもらう」ボタンをクリック
   - [ ] 提案結果が表示されることを確認

3. **レシピ選択と差し替え**
   - [ ] 1つ目のレシピカードをクリック
   - [ ] レシピがプランに差し替えられることを確認
   - [ ] 「レシピを差し替えました！」アラートが表示されることを確認
   - [ ] ホーム画面に遷移することを確認

4. **差し替え後の確認**
   - [ ] ホーム画面で差し替えたレシピが表示されることを確認
   - [ ] プラン画面で差し替えたレシピが表示されることを確認

**期待される結果:**
- レシピ差し替えが正常に動作する
- プランが正しく更新される

**確認ポイント:**
- URLパラメータが正しく処理される
- 差し替えたレシピのステータスが`"swapped"`になる

---

### シナリオ4-6: 買い物リストページでの操作

**前提条件:**
- Active状態のプランが存在する
- レシピ詳細が生成済み
- 買い物リストが生成済み

**テストステップ:**

1. **買い物リストページの表示確認**
   - [ ] ナビゲーションから「買い物」をタップ
   - [ ] 買い物リストページ（`/shopping`）が表示されることを確認

2. **買い物リストの表示確認**
   - [ ] 「買い物リスト」タイトルが表示されることを確認
   - [ ] 購入済みアイテム数/総アイテム数が表示されることを確認
   - [ ] 表示モード切り替えタブ（カテゴリ別/週単位）が表示されることを確認

3. **カテゴリ別表示の確認**
   - [ ] 「カテゴリ別」タブが選択されていることを確認
   - [ ] カテゴリごとにアイテムが表示されることを確認
   - [ ] カテゴリをクリックして展開/折りたたみが動作することを確認
   - [ ] 各アイテムにチェックボックスが表示されることを確認

4. **アイテムのチェック操作**
   - [ ] 複数のアイテムのチェックボックスをクリック
   - [ ] チェック済みアイテムに取り消し線が表示されることを確認
   - [ ] 購入済みアイテム数が更新されることを確認

5. **週単位表示の確認**
   - [ ] 「週単位」タブをクリック
   - [ ] 週ごとにアイテムが表示されることを確認
   - [ ] 週をクリックして展開/折りたたみが動作することを確認
   - [ ] カテゴリごとのアイテムが表示されることを確認

6. **Complete!バッジの表示確認**
   - [ ] すべてのアイテムをチェック
   - [ ] 「Complete!」バッジが表示されることを確認

**期待される結果:**
- 買い物リストが正しく表示される
   - チェック機能が正常に動作する
   - 表示モード切り替えが正常に動作する

**確認ポイント:**
- 買い物リストがない場合は適切なメッセージが表示される
- チェック状態は楽観的UI更新のみ（DB更新は今後実装予定）

---

### シナリオ4-7: レシピ履歴ページでの操作

**前提条件:**
- Active状態のプランが存在する
- いくつかのレシピが提案されている

**テストステップ:**

1. **レシピ履歴ページの表示確認**
   - [ ] ナビゲーションから「履歴」をタップ
   - [ ] レシピ履歴ページ（`/history`）が表示されることを確認

2. **すべてタブの確認**
   - [ ] 「すべて」タブが選択されていることを確認
   - [ ] レシピカード一覧が表示されることを確認:
     - [ ] レシピタイトル
     - [ ] 「作った」バッジ（作成済みの場合）
     - [ ] お気に入りアイコン（お気に入り登録済みの場合）
     - [ ] タグ（最大3つ）
     - [ ] カロリー
     - [ ] 「また作りたい」ボタン（お気に入り未登録の場合）

3. **レシピ詳細への遷移**
   - [ ] レシピカードをクリック
   - [ ] レシピ詳細ページに遷移することを確認

4. **また作りたいリストへの追加**
   - [ ] レシピ履歴ページに戻る
   - [ ] 「また作りたい」ボタンをクリック
   - [ ] ページがリロードされることを確認
   - [ ] お気に入りアイコンが表示されることを確認

5. **また作りたいタブの確認**
   - [ ] 「また作りたい」タブをクリック
   - [ ] お気に入りレシピ一覧が表示されることを確認:
     - [ ] ハートアイコン
     - [ ] レシピタイトル
     - [ ] タグ（最大3つ）
     - [ ] 作成回数

6. **お気に入りレシピの確認**
   - [ ] お気に入りレシピカードをクリック
   - [ ] レシピ詳細ページに遷移することを確認

**期待される結果:**
- レシピ履歴が正しく表示される
- お気に入り機能が正常に動作する
- タブ切り替えが正常に動作する

**確認ポイント:**
- レシピ履歴がない場合は適切なメッセージが表示される
- お気に入りリストがない場合も適切なメッセージが表示される

---

### シナリオ4-8: プラン画面での操作（Active状態）

**前提条件:**
- Active状態のプランが存在する
- プラン画面（`/plan`）が表示されている

**テストステップ:**

1. **Active状態のプラン表示確認**
   - [ ] 「2週間プラン」タイトルが表示されることを確認
   - [ ] 開始日が表示されることを確認
   - [ ] 「飽きた」ボタンと「一括再生成」ボタンが表示されることを確認
   - [ ] 日別カードが簡易表示されることを確認

2. **レシピ詳細への遷移**
   - [ ] 日別カードのレシピタイトルをクリック
   - [ ] レシピ詳細ページに遷移することを確認

3. **「飽きた」ボタンの操作**
   - [ ] 「飽きた」ボタンをクリック
   - [ ] 飽き防止ダイアログが表示されることを確認

4. **「一括再生成」ボタンの操作**
   - [ ] 「一括再生成」ボタンをクリック
   - [ ] 確認ダイアログが表示されることを確認:
     ```
     14日間のプランを一括で再生成しますか？
     現在のプランはアーカイブされ、新しいプランが生成されます。
     生成後、プランを確認して承認してください。
     ```
   - [ ] 「キャンセル」をクリック → ダイアログが閉じることを確認
   - [ ] 再度「一括再生成」ボタンをクリック
   - [ ] 「OK」をクリック
   - [ ] プラン生成が開始されることを確認
   - [ ] Pending状態のプラン表示に切り替わることを確認

**期待される結果:**
- Active状態のプランが正しく表示される
- 各ボタンが正常に動作する
- 一括再生成が正常に動作する

**確認ポイント:**
- 一括再生成後は承認フローに入る

---

### シナリオ4-9: 飽き防止ダイアログでの操作

**前提条件:**
- Active状態のプランが存在する
- プラン画面（`/plan`）が表示されている
- 「飽きた」ボタンをクリック済み

**テストステップ:**

1. **ローディングステップの確認**
   - [ ] 飽き防止ダイアログが表示されることを確認
   - [ ] 「新しいレシピを提案しています...」メッセージが表示されることを確認
   - [ ] ローディングスピナーが表示されることを確認

2. **レシピ選択ステップの確認**
   - [ ] 5つのレシピカードが表示されることを確認:
     - [ ] レシピタイトル
     - [ ] 説明文
     - [ ] タグ
     - [ ] Good/Badボタン
   - [ ] 「気分に合わせたレシピを選んでください」メッセージが表示されることを確認

3. **Good/Bad選択**
   - [ ] 1つ目のレシピの「Good」ボタンをクリック
   - [ ] レシピカードが緑色になることを確認
   - [ ] 2つ目のレシピの「Bad」ボタンをクリック
   - [ ] レシピカードが赤色になることを確認
   - [ ] 再度「Good」ボタンをクリック → 選択が解除されることを確認

4. **プランリフレッシュの実行**
   - [ ] 「プランをリフレッシュ」ボタンをクリック
   - [ ] リフレッシュ中ステップが表示されることを確認:
     - [ ] 「あなたの好みに合わせてプランを更新しています...」メッセージ
     - [ ] ローディングスピナー

5. **完了ステップの確認**
   - [ ] 「プランを更新しました！」メッセージが表示されることを確認
   - [ ] 2秒後にダイアログが閉じることを確認
   - [ ] プランが更新されることを確認

6. **キャンセル操作**
   - [ ] 再度「飽きた」ボタンをクリック
   - [ ] 「キャンセル」ボタンをクリック
   - [ ] ダイアログが閉じることを確認

**期待される結果:**
- 飽き防止ダイアログが正常に動作する
- Good/Bad選択が正常に動作する
- プランリフレッシュが正常に動作する

**確認ポイント:**
- 少なくとも1つはGoodまたはBadを選択する必要がある
- エラー時は適切なエラーメッセージが表示される

---

### シナリオ4-10: チートデイページでの操作

**前提条件:**
- Active状態のプランが存在する
- 今日がチートデイに設定されている

**テストステップ:**

1. **チートデイページへのアクセス**
   - [ ] チートデイページ（`/cheat-day`）にアクセス
   - [ ] チートデイページが表示されることを確認

2. **チートデイ表示の確認**
   - [ ] 紙吹雪アニメーションが実行されることを確認
   - [ ] 「🎉 CHEAT DAY!」メッセージが表示されることを確認
   - [ ] 「今日は好きなものを楽しむ日」説明が表示されることを確認
   - [ ] チートデイカードが表示されることを確認
   - [ ] チートデイのコツカードが表示されることを確認

3. **ホームに戻る操作**
   - [ ] 「ホームに戻る」ボタンをクリック
   - [ ] ホーム画面に遷移することを確認
   - [ ] ホーム画面でチートデイ表示が表示されることを確認

4. **チートデイでない場合の確認**
   - [ ] チートデイでない日にチートデイページにアクセス
   - [ ] 「今日はチートデイではありません」メッセージが表示されることを確認
   - [ ] 「プランを確認する」ボタンが表示されることを確認
   - [ ] 「プランを確認する」ボタンをクリック
   - [ ] プラン画面に遷移することを確認

**期待される結果:**
- チートデイページが正しく表示される
- チートデイでない場合も適切に処理される

**確認ポイント:**
- チートデイの判定が正しく動作する

---

## エッジケース・エラーケース

### シナリオE-1: ネットワークエラー時の動作

**前提条件:**
- ネットワーク接続を切断する

**テストステップ:**

1. **プラン作成時のエラー**
   - [ ] プラン作成を開始
   - [ ] ネットワークエラーが発生することを確認
   - [ ] 適切なエラーメッセージが表示されることを確認

2. **レシピ提案時のエラー**
   - [ ] 冷蔵庫提案ページでレシピ提案を実行
   - [ ] ネットワークエラーが発生することを確認
   - [ ] 適切なエラーメッセージが表示されることを確認

**期待される結果:**
- エラーが適切に処理される
- ユーザーに分かりやすいエラーメッセージが表示される

---

### シナリオE-2: プラン生成タイムアウト

**前提条件:**
- プラン生成が長時間かかる場合

**テストステップ:**

1. **プラン生成の開始**
   - [ ] プラン作成を開始
   - [ ] プラン作成中画面が表示されることを確認

2. **長時間待機**
   - [ ] 5分以上待機
   - [ ] 状態が定期的にチェックされることを確認

3. **プラン生成完了の確認**
   - [ ] プラン生成が完了することを確認
   - [ ] Pending状態のプランが表示されることを確認

**期待される結果:**
- タイムアウトが適切に処理される
- ユーザーに適切なフィードバックが提供される

---

### シナリオE-3: レシピ詳細未生成時の動作

**前提条件:**
- Active状態のプランが存在する
- レシピ詳細が未生成の状態

**テストステップ:**

1. **レシピ詳細ページへのアクセス**
   - [ ] レシピ詳細ページにアクセス
   - [ ] レシピ詳細が自動的に生成されることを確認
   - [ ] ローディング表示が表示されることを確認

2. **レシピ詳細生成完了の確認**
   - [ ] レシピ詳細が生成されることを確認
   - [ ] 材料と手順が表示されることを確認

**期待される結果:**
- レシピ詳細がオンデマンドで生成される
- ユーザー体験が損なわれない

---

## テスト実行チェックリスト

### フェーズ1: 開始フェーズ
- [ ] シナリオ1-1: Googleログイン → 新規ユーザーのオンボーディング
- [ ] シナリオ1-2: ゲストログイン → オンボーディング
- [ ] シナリオ1-3: 既存ユーザーのログイン（オンボーディング完了済み）

### フェーズ2: プラン作成フェーズ
- [ ] シナリオ2-1: プランなし状態からプラン作成
- [ ] シナリオ2-2: プラン作成中の状態確認

### フェーズ3: 承認フェーズ
- [ ] シナリオ3-1: プラン承認フロー
- [ ] シナリオ3-2: プラン拒否フロー

### フェーズ4: 日常利用フェーズ
- [ ] シナリオ4-1: ホーム画面での操作
- [ ] シナリオ4-2: レシピ詳細ページでの操作（未完了時）
- [ ] シナリオ4-3: レシピ詳細ページでの操作（完了済み時）
- [ ] シナリオ4-4: 冷蔵庫提案ページでの操作（通常モード）
- [ ] シナリオ4-5: 冷蔵庫提案ページでの操作（差し替えモード）
- [ ] シナリオ4-6: 買い物リストページでの操作
- [ ] シナリオ4-7: レシピ履歴ページでの操作
- [ ] シナリオ4-8: プラン画面での操作（Active状態）
- [ ] シナリオ4-9: 飽き防止ダイアログでの操作
- [ ] シナリオ4-10: チートデイページでの操作

### エッジケース・エラーケース
- [ ] シナリオE-1: ネットワークエラー時の動作
- [ ] シナリオE-2: プラン生成タイムアウト
- [ ] シナリオE-3: レシピ詳細未生成時の動作

---

## テストデータ

### テストユーザー1: 新規ユーザー
- **用途**: オンボーディングフローのテスト
- **プロフィール**:
  - ニックネーム: テストユーザー1
  - 現在の体重: 65kg
  - 目標体重: 60kg
  - 年齢: 30
  - 性別: 男性
  - 身長: 170cm
  - 活動レベル: 週2-3回の運動
  - 目標: 痩せたい

### テストユーザー2: 既存ユーザー（プランあり）
- **用途**: 日常利用フェーズのテスト
- **プロフィール**: オンボーディング完了済み
- **プラン**: Active状態のプランが存在

### テストユーザー3: 既存ユーザー（プランなし）
- **用途**: プラン作成フローのテスト
- **プロフィール**: オンボーディング完了済み
- **プラン**: プランなし

---

## テスト実行時の注意事項

1. **テスト環境の準備**
   - テスト用のFirebaseプロジェクトを使用する
   - テストデータを事前に準備する

2. **テスト実行順序**
   - フェーズ1から順番に実行することを推奨
   - 各シナリオは独立して実行可能

3. **テスト結果の記録**
   - 各シナリオの実行結果を記録する
   - 問題が発生した場合はスクリーンショットを取得する
   - エラーメッセージを記録する

4. **回帰テスト**
   - 新機能追加後は関連するシナリオを再実行する
   - 既存機能への影響を確認する

---

## まとめ

このテストシナリオドキュメントは、FaveFitアプリケーションの全画面操作を検証するための包括的なテストケースを提供します。各シナリオは実際のユーザー操作を想定して作成されており、アプリケーションの品質を保証するために活用できます。

テスト実行時は、このドキュメントを参照しながら、各シナリオを順番に実行し、期待される結果と実際の動作を比較してください。問題が発見された場合は、ユーザーフロードキュメント（`user-flow.md`）と照らし合わせて、期待される動作と実際の動作の差異を明確にしてください。
