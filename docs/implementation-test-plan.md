# 実装テスト計画

## 概要

改善ポイントの実装前に、各機能のテスト項目を定義します。実装後、これらのテスト項目に基づいて動作確認を行います。

---

## 実装1: 確認ダイアログコンポーネントの作成

### 実装内容
- Radix UIの`Dialog`を使用した確認ダイアログコンポーネントを作成
- `confirm()`を置き換え

### テスト項目

#### 1.1 コンポーネントの基本動作
- [ ] 確認ダイアログが表示される
- [ ] タイトルとメッセージが正しく表示される
- [ ] 「OK」と「キャンセル」ボタンが表示される
- [ ] ダイアログの背景（オーバーレイ）が表示される
- [ ] ESCキーでダイアログを閉じられる
- [ ] 背景をクリックしてダイアログを閉じられる（オプション）

#### 1.2 プラン拒否時の確認ダイアログ
- [ ] 「別のプランを生成する」ボタンをクリック
- [ ] 確認ダイアログが表示される
- [ ] メッセージが「このプランを拒否しますか？別のプランを生成できます。」と表示される
- [ ] 「キャンセル」をクリック → ダイアログが閉じ、プランがそのまま表示される
- [ ] 「OK」をクリック → プランが拒否され、処理が実行される

#### 1.3 一括再生成時の確認ダイアログ
- [ ] 「一括再生成」ボタンをクリック
- [ ] 確認ダイアログが表示される
- [ ] メッセージが「14日間のプランを一括で再生成しますか？現在のプランはアーカイブされ、新しいプランが生成されます。生成後、プランを確認して承認してください。」と表示される
- [ ] 「キャンセル」をクリック → ダイアログが閉じ、プランがそのまま表示される
- [ ] 「OK」をクリック → プラン再生成が開始される

#### 1.4 デザイン確認
- [ ] ダイアログのデザインがアプリのデザインシステムと一致している
- [ ] モバイルでの表示が適切である
- [ ] ボタンのスタイルが統一されている
- [ ] アニメーションがスムーズである

#### 1.5 アクセシビリティ
- [ ] キーボードナビゲーションが動作する（Tab、Enter、ESC）
- [ ] スクリーンリーダーで適切に読み上げられる
- [ ] フォーカス管理が適切である

---

## 実装2: トースト通知の導入

### 実装内容
- `sonner`などのトースト通知ライブラリを導入
- `alert()`を置き換え

### テスト項目

#### 2.1 トースト通知の基本動作
- [ ] トースト通知が表示される
- [ ] トースト通知が自動的に消える（デフォルトの持続時間）
- [ ] トースト通知を手動で閉じられる
- [ ] 複数のトースト通知が適切にスタックされる

#### 2.2 プラン承認時のトースト通知
- [ ] 「このプランで進める」ボタンをクリック
- [ ] プラン承認処理が開始される
- [ ] 成功時にトースト通知が表示される
- [ ] メッセージが「プランを承認しました。レシピ詳細を生成中です。完了まで1〜2分かかる場合があります。」と表示される
- [ ] トースト通知のスタイルが成功メッセージ用である（緑色など）

#### 2.3 プラン拒否時のトースト通知
- [ ] プラン拒否を実行
- [ ] 成功時にトースト通知が表示される
- [ ] メッセージが「プランを拒否しました。」と表示される

#### 2.4 プラン生成時のトースト通知
- [ ] プラン生成を開始
- [ ] 成功時にトースト通知が表示される（オプション）
- [ ] エラー時にエラートースト通知が表示される
- [ ] エラーメッセージが適切に表示される

#### 2.5 一括再生成時のトースト通知
- [ ] 一括再生成を実行
- [ ] 成功時にトースト通知が表示される
- [ ] メッセージが「14日間のプランを一括再生成しました。プランを確認して承認してください。」と表示される

#### 2.6 エラー時のトースト通知
- [ ] ネットワークエラー時にエラートースト通知が表示される
- [ ] エラーメッセージが適切に表示される
- [ ] トースト通知のスタイルがエラーメッセージ用である（赤色など）

#### 2.7 デザイン確認
- [ ] トースト通知のデザインがアプリのデザインシステムと一致している
- [ ] モバイルでの表示が適切である
- [ ] 成功/エラー/情報メッセージで異なるスタイルが適用される

---

## 実装3: プラン作成中画面の統一

### 実装内容
- 共通コンポーネントを作成
- すべての画面で統一されたデザインを適用

### テスト項目

#### 3.1 共通コンポーネントの基本動作
- [ ] プラン作成中画面コンポーネントが表示される
- [ ] ローディングスピナーが表示される
- [ ] 「プラン作成中...」メッセージが表示される
- [ ] 説明文が表示される

#### 3.2 各画面での表示確認
- [ ] `/plan`でプラン作成中画面が表示される
- [ ] `/home`でプラン作成中画面が表示される
- [ ] `/onboarding`でプラン作成中画面が表示される
- [ ] すべての画面で同じデザインが表示される

#### 3.3 デザイン統一の確認
- [ ] ローディングスピナーのサイズと位置が統一されている
- [ ] メッセージのフォントサイズとスタイルが統一されている
- [ ] 説明文の内容とスタイルが統一されている
- [ ] レイアウトが統一されている

#### 3.4 プラン生成完了後の動作
- [ ] プラン生成完了後、自動的にPending状態のプラン表示に切り替わる
- [ ] 状態遷移がスムーズである
- [ ] エラーなく動作する

---

## 実装4: プラン生成後の再取得タイミングの改善

### 実装内容
- プラン生成API呼び出し後の処理を改善
- プラン作成中画面への遷移を確実にする

### テスト項目

#### 4.1 プラン生成開始時の動作
- [ ] 「プランを作成する」ボタンをクリック
- [ ] プラン生成APIが呼び出される
- [ ] 即座にプラン作成中画面に遷移する
- [ ] 「読み込み中...」が表示されない（または最小限）

#### 4.2 プラン生成中の状態管理
- [ ] `planCreationStatus`が`"creating"`に設定される
- [ ] プラン作成中画面が表示される
- [ ] 5秒ごとにプラン状態がチェックされる
- [ ] プラン生成完了まで待機する

#### 4.3 プラン生成完了後の動作
- [ ] プラン生成完了後、自動的にPending状態のプランを取得する
- [ ] Pending状態のプランが表示される
- [ ] プラン作成中画面から自動的に遷移する
- [ ] エラーなく動作する

#### 4.4 一括再生成時の動作
- [ ] 「一括再生成」ボタンをクリック
- [ ] 確認ダイアログで「OK」をクリック
- [ ] 即座にプラン作成中画面に遷移する
- [ ] プラン生成が開始される
- [ ] プラン生成完了後、Pending状態のプランが表示される

#### 4.5 エラー時の動作
- [ ] プラン生成中にエラーが発生した場合、適切なエラーメッセージが表示される
- [ ] エラー後も状態が適切に管理される
- [ ] 再試行が可能である

---

## 実装5: その他の改善（低優先度）

### 実装内容
- デザインの細かい調整
- パフォーマンスの最適化

### テスト項目

#### 5.1 プラン概要カードの視認性
- [ ] 平均栄養価の表示が読みやすい
- [ ] 目標との差分が分かりやすい
- [ ] タグの表示が適切である

#### 5.2 日別カードの情報密度
- [ ] 情報が適切に整理されている
- [ ] 読みやすさが向上している
- [ ] モバイルでの表示が適切である

#### 5.3 承認/拒否ボタンの配置
- [ ] ボタンが適切に配置されている
- [ ] スクロールしなくても見える（またはsticky footer）
- [ ] モバイルでの表示が適切である

---

## 統合テスト

### エンドツーエンドテスト

#### シナリオ1: プラン作成から承認まで
1. [ ] プランなし状態から開始
2. [ ] 「プランを作成する」ボタンをクリック
3. [ ] プラン作成中画面が表示される（統一されたデザイン）
4. [ ] プラン生成完了後、Pending状態のプランが表示される
5. [ ] プラン概要カードが表示される
6. [ ] 「このプランで進める」ボタンをクリック
7. [ ] トースト通知が表示される（成功メッセージ）
8. [ ] Active状態のプランが表示される

#### シナリオ2: プラン拒否から再生成まで
1. [ ] Pending状態のプランが表示されている
2. [ ] 「別のプランを生成する」ボタンをクリック
3. [ ] 確認ダイアログが表示される（カスタムコンポーネント）
4. [ ] 「OK」をクリック
5. [ ] トースト通知が表示される（成功メッセージ）
6. [ ] プラン作成中画面が表示される
7. [ ] 新しいPending状態のプランが表示される

#### シナリオ3: 一括再生成
1. [ ] Active状態のプランが表示されている
2. [ ] 「一括再生成」ボタンをクリック
3. [ ] 確認ダイアログが表示される（カスタムコンポーネント）
4. [ ] 「OK」をクリック
5. [ ] トースト通知が表示される（成功メッセージ）
6. [ ] プラン作成中画面が表示される
7. [ ] 新しいPending状態のプランが表示される

---

## テスト実行時の注意事項

1. **ブラウザでの確認**
   - Chrome、Safari、Firefoxで動作確認
   - モバイルブラウザ（iOS Safari、Chrome Mobile）で動作確認

2. **レスポンシブデザイン**
   - デスクトップ、タブレット、モバイルで表示確認
   - 画面サイズの変更時の動作確認

3. **アクセシビリティ**
   - キーボードナビゲーションの確認
   - スクリーンリーダーの確認（可能な場合）

4. **パフォーマンス**
   - プラン生成時の動作確認
   - 状態遷移のスムーズさの確認
