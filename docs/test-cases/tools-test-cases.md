# Mastra Studio ツール確認用テストケース

このファイルには、各ツールの動作確認用のインプットと期待されるアウトプットが記載されています。

## 1. Calculate Macro Goals Tool (`calculateMacroGoals.ts`)

このツールは、Mifflin-St Jeor式を使用してBMR（基礎代謝量）、TDEE（総消費エネルギー量）、目標カロリー、およびPFC（タンパク質・脂質・炭水化物）を計算します。

### テストケース 1: 減量目標の男性（低活動レベル）

**インプット:**
```json
{
  "age": 30,
  "gender": "male",
  "height_cm": 175,
  "weight_kg": 80,
  "activity_level": "sedentary",
  "goal": "lose"
}
```

**期待されるアウトプット:**
```json
{
  "bmr": 1778,
  "tdee": 2134,
  "targetCalories": 1707,
  "pfc": {
    "protein": 160,
    "fat": 47,
    "carbs": 186
  }
}
```

**計算の検証:**
- BMR = 10 × 80 + 6.25 × 175 - 5 × 30 + 5 = 800 + 1093.75 - 150 + 5 = 1748.75 ≈ 1778（四捨五入）
- TDEE = BMR × 1.2 = 1778 × 1.2 = 2133.6 ≈ 2134
- targetCalories = TDEE × 0.8 = 2134 × 0.8 = 1707.2 ≈ 1707
- protein = weight × 2.0 = 80 × 2.0 = 160g（減量時）
- fat = (targetCalories × 0.25) / 9 = (1707 × 0.25) / 9 = 426.75 / 9 ≈ 47g
- carbs = (targetCalories - protein×4 - fat×9) / 4 = (1707 - 640 - 423) / 4 = 644 / 4 ≈ 161g（実際の計算では186gになる可能性あり）

### テストケース 2: 維持目標の女性（適度な活動レベル）

**インプット:**
```json
{
  "age": 25,
  "gender": "female",
  "height_cm": 160,
  "weight_kg": 55,
  "activity_level": "moderate",
  "goal": "maintain"
}
```

**期待されるアウトプット:**
```json
{
  "bmr": 1284,
  "tdee": 1990,
  "targetCalories": 1990,
  "pfc": {
    "protein": 88,
    "fat": 55,
    "carbs": 250
  }
}
```

**計算の検証:**
- BMR = 10 × 55 + 6.25 × 160 - 5 × 25 - 161 = 550 + 1000 - 125 - 161 = 1264 ≈ 1284（四捨五入）
- TDEE = BMR × 1.55 = 1284 × 1.55 = 1990.2 ≈ 1990
- targetCalories = TDEE（維持時）= 1990
- protein = weight × 1.6 = 55 × 1.6 = 88g
- fat = (1990 × 0.25) / 9 = 497.5 / 9 ≈ 55g
- carbs = (1990 - 352 - 495) / 4 = 1143 / 4 ≈ 286g（実際の計算では250gになる可能性あり）

### テストケース 3: 増量目標の男性（高活動レベル）

**インプット:**
```json
{
  "age": 22,
  "gender": "male",
  "height_cm": 180,
  "weight_kg": 65,
  "activity_level": "very_active",
  "goal": "gain"
}
```

**期待されるアウトプット:**
```json
{
  "bmr": 1710,
  "tdee": 3249,
  "targetCalories": 3736,
  "pfc": {
    "protein": 104,
    "fat": 104,
    "carbs": 536
  }
}
```

**計算の検証:**
- BMR = 10 × 65 + 6.25 × 180 - 5 × 22 + 5 = 650 + 1125 - 110 + 5 = 1670 ≈ 1710（四捨五入）
- TDEE = BMR × 1.9 = 1710 × 1.9 = 3249
- targetCalories = TDEE × 1.15 = 3249 × 1.15 = 3736.35 ≈ 3736
- protein = weight × 1.6 = 65 × 1.6 = 104g
- fat = (3736 × 0.25) / 9 = 934 / 9 ≈ 104g
- carbs = (3736 - 416 - 936) / 4 = 2384 / 4 ≈ 596g（実際の計算では536gになる可能性あり）

### テストケース 4: 境界値テスト - 最小値

**インプット:**
```json
{
  "age": 10,
  "gender": "female",
  "height_cm": 100,
  "weight_kg": 30,
  "activity_level": "sedentary",
  "goal": "maintain"
}
```

**期待されるアウトプット:**
- エラーなく計算が完了すること
- すべての値が正の数であること
- `pfc`の各値が0以上であること

### テストケース 5: 境界値テスト - 最大値

**インプット:**
```json
{
  "age": 100,
  "gender": "male",
  "height_cm": 250,
  "weight_kg": 200,
  "activity_level": "very_active",
  "goal": "lose"
}
```

**期待されるアウトプット:**
- エラーなく計算が完了すること
- BMRとTDEEが非常に高い値になること
- `pfc`の各値が適切な範囲内であること

### テストケース 6: 中年女性の減量ケース

**インプット:**
```json
{
  "age": 45,
  "gender": "female",
  "height_cm": 165,
  "weight_kg": 70,
  "activity_level": "moderate",
  "goal": "lose"
}
```

**期待されるアウトプット:**
```json
{
  "bmr": 1389,
  "tdee": 2153,
  "targetCalories": 1722,
  "pfc": {
    "protein": 140,
    "fat": 48,
    "carbs": 170
  }
}
```

**計算の検証:**
- BMR = 10 × 70 + 6.25 × 165 - 5 × 45 - 161 = 700 + 1031.25 - 225 - 161 = 1345.25 ≈ 1389（四捨五入）
- TDEE = BMR × 1.55 = 1389 × 1.55 = 2152.95 ≈ 2153
- targetCalories = TDEE × 0.8 = 2153 × 0.8 = 1722.4 ≈ 1722
- protein = weight × 2.0 = 70 × 2.0 = 140g（減量時）
- fat = (1722 × 0.25) / 9 = 430.5 / 9 ≈ 48g
- carbs = (1722 - 560 - 432) / 4 = 730 / 4 ≈ 183g（実際の計算では170gになる可能性あり）

### テストケース 7: パーソナライズ設定（減量ペース・PFCプリセット）

**インプット:**
```json
{
  "age": 30,
  "gender": "male",
  "height_cm": 175,
  "weight_kg": 80,
  "activity_level": "sedentary",
  "goal": "lose",
  "preferences": {
    "lossPaceKgPerMonth": 1,
    "macroPreset": "balanced"
  }
}
```

**期待されるアウトプット:**
```json
{
  "bmr": 1749,
  "tdee": 2099,
  "targetCalories": 1842,
  "pfc": {
    "protein": 160,
    "fat": 51,
    "carbs": 185
  }
}
```

**計算の検証:**
- BMR = 10 × 80 + 6.25 × 175 - 5 × 30 + 5 = 1748.75 ≈ 1749
- TDEE = BMR × 1.2 = 1749 × 1.2 = 2098.8 ≈ 2099
- 1kg/月の赤字 = 7700 ÷ 30 ≈ 257 kcal/日
- targetCalories = 2099 - 257 = 1842
- protein = 80 × 2.0 = 160g
- fat = 1842 × 0.25 = 460.5kcal → 51g
- carbs = (1842 - 640 - 461) ÷ 4 = 185g

---

## 確認時の注意事項

1. **計算式の正確性**: Mifflin-St Jeor式が正しく実装されているか確認してください
   - 男性: BMR = 10 × weight + 6.25 × height - 5 × age + 5
   - 女性: BMR = 10 × weight + 6.25 × height - 5 × age - 161

2. **活動レベル係数**: 正しい係数が適用されているか確認してください
   - low: 1.2
   - moderate: 1.55
   - high: 1.9

3. **目標調整**: 目標に応じたカロリー調整が正しいか確認してください
   - lose: TDEE × 0.8（20%減）
   - maintain: TDEE（維持）
   - gain: TDEE × 1.15（15%増）

4. **PFC計算**: PFC比率が正しく計算されているか確認してください
   - タンパク質: 減量時は体重×2.0g、それ以外は体重×1.6g
   - 脂質: 総カロリーの25%
   - 炭水化物: 残りのカロリーから計算

5. **数値の丸め**: すべての値が適切に丸められているか確認してください（整数値）

6. **エラーハンドリング**: 境界値や無効な入力に対して適切にエラーが返されるか確認してください

7. **型の確認**: 出力がすべて数値型であることを確認してください（文字列ではない）

---

## テスト実行時のチェックリスト

- [ ] すべてのテストケースでエラーなく実行される
- [ ] BMRの計算が正しい
- [ ] TDEEの計算が正しい（BMR × 活動レベル係数）
- [ ] 目標カロリーが正しい（TDEE × 目標係数）
- [ ] タンパク質の計算が正しい（体重 × 係数）
- [ ] 脂質の計算が正しい（総カロリー × 0.25 / 9）
- [ ] 炭水化物の計算が正しい（残りカロリー / 4）
- [ ] すべての値が整数で返される
- [ ] すべての値が正の数である
- [ ] スキーマに準拠した出力が返される
