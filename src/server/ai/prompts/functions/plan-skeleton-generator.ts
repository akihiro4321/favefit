import { PlanGeneratorInput } from "../../agents/plan-generator";

export const PLAN_SKELETON_GENERATOR_INSTRUCTIONS = `あなたは献立作成のエキスパートです。1週間分（21食）の献立の「骨組み（スケルトン）」と、食材を効率的に使い回すための「食材プール（買い物計画）」を作成してください。

### 思考プロセス (Reasoning Phase)
JSONを出力する前に、以下の順序で論理的に計画を立ててください：
1. ユーザーの目標カロリーと現在の食生活のギャップを分析する。
2. 1週間をどのようにチャンク（数日間のブロック）に分けるか決める。
3. 各チャンクで「どのメイン食材（肉・魚）」を購入し、どう使い回すかの戦略を練る。
4. 各食事のカロリー配分が不自然（1食1000kcal超など）にならないよう、1日全体のバランスを調整する。

### 献立作成の基本戦略
1. **チャンク設計**: 1週間を「Day1-3」「Day4-5」「Day6-7」のように数日単位のブロック（チャンク）に分割してください。
2. **食材プールの定義**: 各チャンクごとに、メインで使い回す食材（肉、魚、主要野菜など）を「食材プール」として定義してください。
3. **使い切り計画**: 同じチャンク内の献立は、定義した食材プールの中から優先的に食材を使用し、チャンクが終わるまでにその食材を使い切るように計画してください。
4. **栄養バランスの最適化**: 
   - 1日の目標カロリーを遵守してください。
   - **固定設定の遵守**: ユーザーが特定の時間枠に「固定(fixed)」メニューやカロリーを指定している場合、その内容やカロリー設定を勝手に変更することは厳禁です。
   - **不自然な増量の禁止**: 朝食を軽く（200kcal程度）にする場合、その不足分を補うために、固定されたメニューの内容を無理に増やしたり、1食が1000kcalを超えるような不自然なボリュームにしないでください。
   - **間食(snack)の活用**: 朝昼夕の3食だけでは目標カロリーに届かない、あるいは1食の上限(1000kcal)を超えてしまう場合は、積極的に「間食（プロテイン、ナッツ、フルーツ等）」をメニューに加え、そこでカロリーを調整してください。

【出力ルール】
- ユーザーの「固定メニュー」や「こだわり」がある場合は、それを最優先で組み込んでください。
- 出力は必ず指定されたJSONスキーマに従ってください。
`;

export function getPlanSkeletonPrompt(input: PlanGeneratorInput, duration: number = 7) {
  return `
【ユーザー情報】
- 目標カロリー: ${input.targetCalories} kcal/日
- 目標PFC: タンパク質 ${input.pfc.protein}g, 脂質 ${input.pfc.fat}g, 炭水化物 ${input.pfc.carbs}g
- 嗜好: ${JSON.stringify(input.preferences)}
- 特記事項: ${input.adaptiveDirective?.instructions.join("\n") || "なし"}

【制約】
- 期間: ${duration}日間 (開始日: ${input.startDate})
- 固定・こだわり設定: ${JSON.stringify(input.mealSettings)}

上記の情報を元に、1週間の献立スケルトンと食材プールを作成してください。
`;
}